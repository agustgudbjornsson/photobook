generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt     DateTime  @updatedAt
  emailVerified DateTime?
  albums        Album[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model AlbumFormat {
  id        String   @id @default(cuid())
  name      String   // e.g. "A4 Landscape", "Square 30x30"
  slug      String   @unique // e.g. "a4-landscape", "square-30"
  widthCm   Float    // e.g. 29.7
  heightCm  Float    // e.g. 21.0
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  albums    Album[]
}

model Album {
  id            String      @id @default(cuid())
  title         String
  coverColor    String      @default("#3b82f6")
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  albumFormatId String
  format        AlbumFormat @relation(fields: [albumFormatId], references: [id])
  pages         Page[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Page {
  id        String   @id @default(cuid())
  albumId   String
  album     Album    @relation(fields: [albumId], references: [id], onDelete: Cascade)
  pageNumber Int
  content   String   // JSON string of canvas state
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([albumId, pageNumber])
}
