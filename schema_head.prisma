generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  emailVerified DateTime?
  albums        Album[]
  orders        Order[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model AlbumFormat {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  widthCm   Float
  heightCm  Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  albums    Album[]
}

model Album {
  id            String      @id @default(cuid())
  title         String
  coverColor    String      @default("#3b82f6")
  userId        String
  albumFormatId String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  format        AlbumFormat @relation(fields: [albumFormatId], references: [id])
  orders        Order[]
  pages         Page[]
}

model Order {
  id             String   @id @default(cuid())
  albumId        String
  userId         String
  paperStyle     String
  deliveryMethod String
  customerName   String
  address        String
  city           String?
  zipCode        String?
  country        String?
  status         String   @default("pending")
  totalAmount    Float    @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  album          Album    @relation(fields: [albumId], references: [id])
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Page {
  id         String   @id @default(cuid())
  albumId    String
  pageNumber Int
  content    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  album      Album    @relation(fields: [albumId], references: [id], onDelete: Cascade)

  @@unique([albumId, pageNumber])
}
